<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <title>Monitoring Listrik Kabupaten Aceh</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', sans-serif;
        }

        #map {
            height: 100vh;
            width: 100%;
            background: #ffffff;
        }

        /* Panel Samping */
        .filter-panel {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 1000;
            background: white;
            padding: 20px;
            border-radius: 12px;
            width: 280px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* Style Titik Hijau Kabupaten */
        .kab-marker {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .dot {
            width: 14px;
            height: 14px;
            background: #2ecc71;
            /* Warna Hijau PLN */
            border: 2px solid white;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        .label {
            color: #000;
            font-weight: 800;
            /* Extra bold */
            font-size: 11px;
            /* Strong white halo/outline */
            text-shadow:
                -1px -1px 0 #fff,
                1px -1px 0 #fff,
                -1px 1px 0 #fff,
                1px 1px 0 #fff;
            white-space: nowrap;
            margin-top: 3px;
        }
    </style>
</head>

<body>

    <div class="filter-panel">
        <h3 style="margin:0 0 10px 0; border-bottom: 2px solid #2ecc71; padding-bottom: 5px;">MONITORING KABUPATEN</h3>
        <p style="font-size: 12px; color: #666;">Menampilkan 23 Titik Pusat Kabupaten berstatus Berlistrik PLN.</p>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const map = L.map('map', { attributionControl: false }).setView([4.3, 96.8], 8);

        // Fungsi Warna Wilayah (Persis seperti peta-desa sebelumnya)
        function getMapColor(name) {
            const n = name.toUpperCase();
            if (n.includes("SABANG") || n.includes("BANDA ACEH") || n.includes("BESAR")) return "#8ab67c";
            if (n.includes("JAYA") || n.includes("PIDIE")) return "#489d82";
            if (n.includes("BIREUEN") || n.includes("BENER") || n.includes("LHOKSEUMAWE")) return "#d4af37";
            return "#bc7d4b";
        }

        // 1. Gambar Poligon Wilayah (Aceh Warna-warni)
        fetch('/api/batas-kabupaten')
            .then(res => res.json())
            .then(data => {
                L.geoJSON(data, {
                    style: (f) => ({
                        fillColor: getMapColor(f.properties.Kab_Kota || f.properties.name),
                        fillOpacity: 0.8, color: "white", weight: 1.5
                    })
                }).addTo(map);
            });

        // 2. Gambar 23 Titik Hijau Kabupaten
        fetch('/api/titik-kabupaten')
            .then(res => res.json())
            .then(data => {
                data.forEach(kab => {
                    let namaKab = kab.nama;
                    let koordinat;

                    // LOGIKA POSISI MANUAL
                    if (namaKab.toUpperCase() === "PIDIE") {
                        koordinat = [5.085675217126646, 95.90510815219272];
                    } else if (namaKab.toUpperCase() === "ACEH SINGKIL") {
                        koordinat = [2.375721853360829, 97.78014821397359];
                    } else if (namaKab.toUpperCase().includes("SABANG")) {
                        koordinat = [5.8301251804438, 95.29895152562486];
                    } else if (namaKab.toUpperCase().includes("SIMEULUE")) {
                        koordinat = [2.724911789411968, 95.9425543376239];
                    } else {
                        // Default ke koordinat dari API (pusat bounding box)
                        koordinat = kab.koordinat;
                    }

                    const iconKab = L.divIcon({
                        className: 'custom-icon',
                        html: `<div class="kab-marker"><div class="dot"></div><div class="label">${kab.nama}</div></div>`,
                        iconSize: [100, 40], iconAnchor: [50, 7]
                    });

                    L.marker(koordinat, { icon: iconKab }).addTo(map)
                        .bindPopup(`<b>Kabupaten: ${kab.nama}</b><br>Status: Berlistrik PLN`);
                });
            });
    </script>
</body>

</html>